CREATE TABLE PMIS_ADM.ChangesLog(ChangeID number NOT NULL,
                        UserID number NOT NULL,
                        ChangeDate date NOT NULL,
                        ChangeTypeID number NOT NULL
                        );

ALTER TABLE PMIS_ADM.ChangesLog ADD CONSTRAINT ChangesLog_PK PRIMARY KEY(ChangeID);
ALTER TABLE PMIS_ADM.ChangesLog ADD CONSTRAINT ChangesLog_Users_FK FOREIGN KEY (UserID) REFERENCES PMIS_ADM.Users (UserID);
ALTER TABLE PMIS_ADM.ChangesLog ADD CONSTRAINT ChangesLog_ChangeTypes_FK FOREIGN KEY (ChangeTypeID) REFERENCES PMIS_ADM.ChangeTypes (ChangeTypeID);


CREATE SEQUENCE PMIS_ADM.CHANGESLOG_ID_SEQ
START WITH 1 
INCREMENT BY 1 
NOMAXVALUE;

CREATE TRIGGER PMIS_ADM.TRG_CHANGESLOG_INSERT
BEFORE INSERT ON PMIS_ADM.ChangesLog
FOR EACH ROW
BEGIN
   SELECT PMIS_ADM.CHANGESLOG_ID_SEQ.nextval INTO :new.ChangeID FROM dual;
END;
/
