CREATE TABLE PMIS_ADM.OldPasswords(OldPasswordID number NOT NULL,
                                   UserID number NOT NULL,
                                   OldPassword varchar2(500) NOT NULL,
								   ChangeDate date NOT NULL
								   );

ALTER TABLE PMIS_ADM.OldPasswords ADD CONSTRAINT OldPasswords_PK PRIMARY KEY(OldPasswordID);
ALTER TABLE PMIS_ADM.OldPasswords ADD CONSTRAINT OldPasswords_Users_FK FOREIGN KEY (UserID) REFERENCES PMIS_ADM.Users (UserID);

CREATE SEQUENCE PMIS_ADM.OldPasswords_ID_SEQ
START WITH 1 
INCREMENT BY 1 
NOMAXVALUE;

CREATE TRIGGER PMIS_ADM.TRG_OldPasswords_INSERT
BEFORE INSERT ON PMIS_ADM.OldPasswords
FOR EACH ROW
BEGIN
   SELECT PMIS_ADM.OldPasswords_ID_SEQ.nextval INTO :new.OldPasswordID FROM dual;
END;
/

INSERT INTO PMIS_ADM.OldPasswords (UserID,
                                   OldPassword, 
                                   ChangeDate)
SELECT UserID, Password, SYSDATE
FROM PMIS_ADM.Users;

COMMIT;
/